<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
  <link rel="stylesheet" href="stylesheets/screen.css" type="text/css" media="screen" />
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <title>
      EC2 on Rails
  </title>
  <script src="javascripts/rounded_corners_lite.inc.js" type="text/javascript"></script>
<style>

</style>
  <script type="text/javascript">
    window.onload = function() {
      settings = {
          tl: { radius: 10 },
          tr: { radius: 10 },
          bl: { radius: 10 },
          br: { radius: 10 },
          antiAlias: true,
          autoPad: true,
          validTags: ["div"]
      }
      var versionBox = new curvyCorners(settings, document.getElementById("version"));
      versionBox.applyCornersToAll();
    }
  </script>
</head>
<body>
<div id="main">

    <h1>EC2 on Rails</h1>
    <div id="version" class="clickable" onclick='document.location = "http://rubyforge.org/projects/ec2onrails"; return false'>
      <p>Get Version</p>
      <a href="http://rubyforge.org/projects/ec2onrails" class="numbers">0.9.3</a>
    </div>
    <h2>A Ruby on Rails <span class="caps">EC2</span> &#8220;Appliance&#8221;</h2>


	<p>This is an Ubuntu Linux server image for 
<a href="http://www.amazon.com/b/ref=sc_fe_l_2/102-6342260-7987311?ie=UTF8&#38;node=201590011&#38;no=3435361">Amazon&#8217;s <span class="caps">EC2</span> hosting service</a>
that&#8217;s ready to run a standard Ruby on Rails application with little or no customization. 
Basically it&#8217;s a Ruby on Rails <a href="http://en.wikipedia.org/wiki/Virtual_appliance">virtual appliance</a>.</p>


	<p>My goal is that you should be able to simply start up an instance of the image 
(soon a distributed cluster will be possible) and deploy your app to it using 
Capistrano, with no other steps required. (You can also just copy it and 
customize it if it doesn&#8217;t meet all of your needs.)</p>


	<p><em>Deploying a simple rails app should be simple, and complex customization (if required) should be possible.</em></p>


	<p>Features of the <span class="caps">EC2</span> image:</p>


	<ul>
	<li>Ready to deploy a Rails app with little or no configuration of the server required.</li>
		<li>Automatic backup of MySQL database to S3.</li>
		<li>Capistrano tasks to customize the server image, archive and restore the database to/from S3, and more. Available as a rubygem.</li>
		<li>Mongrel_cluster behind Apache 2.2, configured according to 
  <a href="http://blog.codahale.com/2006/06/19/time-for-a-grown-up-server-rails-mongrel-apache-capistrano-and-you/">Coda Hale&#8217;s excellent guide</a>
  with /etc/init.d startup script</li>
		<li>Ruby on Rails 1.2.4</li>
		<li>Ruby 1.8.5</li>
		<li>MySQL 5</li>
		<li>Ubuntu 7.04 Feisty with <a href="http://wiki.xensource.com/xenwiki/XenSpecificGlibc">Xen versions of standard libs</a> (<a href="http://packages.ubuntu.com/feisty/libs/libc6-xen">libc6-xen</a> package).</li>
		<li>Amazon <span class="caps">AMI</span> tools installed</li>
		<li>A script to rebundle a customized version of the image in one step if required</li>
		<li>MySQL and Apache configured to write logs to /mnt/log so you don&#8217;t fill up <span class="caps">EC2</span>&#8217;s small root filesystem</li>
		<li>Hostname set correctly to public hostname</li>
	</ul>


	<h2>Using the image</h2>


	<p>This documentation will be improved very soon, for now hopefully this covers the basics:</p>


	<p>You need an Amazon <span class="caps">EC2</span> account.</p>


	<p>Install the gem containing the Capistrano tasks:
<pre class='syntax'><span class="ident">sudo</span> <span class="ident">gem</span> <span class="ident">install</span> <span class="ident">ec2onrails</span></pre></p>


	<p>Put <a href="http://ec2onrails.rubyforge.org/svn/trunk/documentation/examples/Capfile">Capfile</a> 
in the root of your rails folder, and put
<a href="http://ec2onrails.rubyforge.org/svn/trunk/documentation/examples/deploy.rb">deploy.rb</a> 
and
<a href="http://ec2onrails.rubyforge.org/svn/trunk/documentation/examples/s3.yml">s3.yml</a>
in the config folder.</p>


	<p>Start an instance of the <span class="caps">EC2</span> image, currently the image id is <strong>ami-a3f91cca</strong> (soon there will be a Capistrano task to do this for 
you so you won&#8217;t need to remember the image id). You need to start it with a public key, the same way
as the Amazon public images work.</p>


	<p>As is <a href="http://docs.amazonwebservices.com/AWSEC2/2007-03-01/DeveloperGuide/public-ami-guidelines.html">standard for public <span class="caps">AMI</span>&#8217;s</a>, 
password-based logins are disabled. This is so that 
neither I nor anyone else (except you) can log into your running instance. 
You log in with your own 
<a href="http://docs.amazonwebservices.com/AmazonEC2/gsg/2007-01-19/running-an-instance.html">public/private keypair</a>.</p>


	<p>You can login as a user named &#8220;admin&#8221; (which has sudo ability) or as &#8220;app&#8221; (the user 
that the app runs as, does not have sudo ability). The Capistrano tasks automatically 
use the app user use to deploy the app, and the admin user for server admin tasks 
that require sudo.</p>


	<h2>Saving your own customized version of the image.</h2>


I&#8217;m trying to make the image customizable enough that you won&#8217;t need to do this, but 
if you want to save a customized version of the image, there is a script to do it: 
<code>/usr/local/ec2onrails/bin/rebundle.sh</code>. It takes a long time and there 
are long periods with no output so you might want to hit a key once in a while 
(or set &#8220;ServerAliveInterval 60&#8221; in your ssh_config file) to avoid being disconnected 
while it&#8217;s running.

	<p>It expects a directory, /mnt/aws-config, that contains a config file and your <span class="caps">AWS</span> 
access identifiers. The contents of the directory are the following three files:</p>


	<ul>
	<li>cert-XXXX.pem and pk-XXXX.pem. These are the X.509 certificate and private key files from your Amazon access key identifiers.</li>
		<li>A file named config. It&#8217;s contents should look like the following:</li>
	</ul>


<pre>
AWS_ACCOUNT_ID=1234-1234-1234
KEY_FILE_NAME=pk-XXXX.pem
CERT_FILE_NAME=cert-XXXX.pem
AWS_ACCESS_KEY_ID=ABC0123
AWS_SECRET_ACCESS_KEY=abc0123abc0123abc0123
BUCKET_BASE_NAME=a-string-identifier
</pre>

	<h2>Building the image</h2>


	<p>Building the image is not required, most people will simply use the prebuilt public
image, but there is also a Rake build script that builds the image, and optionally bundles 
and uploads it to S3. 
It should run on any Linux system, including one of the stock Fedora-based Amazon public <span class="caps">AMI</span>&#8217;s 
(it is tested on <a href="http://developer.amazonwebservices.com/connect/entry!default.jspa?categoryID=101&#38;externalID=521">the <span class="caps">FC4</span> developer image</a>).</p>


	<h2>Forum</h2>


	<p><a href="http://groups.google.com/group/ec2-on-rails-announce">Announcements</a></p>


	<p><a href="http://groups.google.com/group/ec2-on-rails-discuss">Discussion</a></p>


	<h2>Comments</h2>


	<p>Comments are welcome. Send an email to <a href="http://pauldowman.com/contact/">Paul Dowman</a> or to the <a href="http://groups.google.com/group/ec2-on-rails-discuss">Google group</a></p>


	<h2>Issues</h2>


	<p>Please file bugs <a href="http://rubyforge.org/tracker/?atid=17558&#38;group_id=4552&#38;func=browse">here</a> 
or if you don&#8217;t have a RubyForge account send me an <a href="http://pauldowman.com/contact/">email</a>.</p>


	<h2>Change log</h2>


	<p>Also see the <a href="http://rubyforge.org/tracker/?atid=17558&#38;group_id=4552&#38;func=browse">list of open issues</a>.</p>


	<h4>0.9.3, ami-a3f91cca</h4>


7 Oct, 2007
	<ul>
	<li>This is another test release, still not intended to be production-ready until it&#8217;s tested more thoroughly. Look for version 1.0.</li>
		<li>There is now a rubygem available with capistrano tasks.</li>
		<li>&#8220;admin&#8221; user added, server admin cap tasks run as this user</li>
		<li></li>
		<li><a href="issues">http://code.google.com/p/ec2-on-rails/issues/list?can=1&#38;q=label%3AFixed-in-0_9_3</a> fixed in this release</li>
	</ul>


	<h4>0.9.2, ami-0cf61365</h4>


13 Sept, 2007
	<ul>
	<li>This is another test release, still not intended to be production-ready until it&#8217;s tested more thoroughly. Look for version 1.0.</li>
		<li><a href="issues">http://code.google.com/p/ec2-on-rails/issues/list?can=1&#38;q=label%3AFixed-in-0_9_2</a> fixed in this release</li>
	</ul>


	<h4>0.9.1, ami-99f712f0</h4>


11 Sept, 2007
	<ul>
	<li>This is another test release, still not intended to be production-ready until it&#8217;s tested more thoroughly. Look for version 1.0.</li>
		<li>Fixed permissions on /var/lib/dhcp3</li>
		<li><a href="issues">http://code.google.com/p/ec2-on-rails/issues/list?can=1&#38;q=label%3AFixed-in-0_9_1</a> fixed in this release</li>
	</ul>


	<h4>0.9.0, ami-bdf411d4</h4>


7 Sept 2007
	<ul>
	<li>First release built with new rake build script, this is a test release, not intended to be production-ready until it&#8217;s tested more thoroughly.</li>
		<li>Amazon <span class="caps">EC2 API</span> tools (java-based) no longer installed by default because they&#8217;re not used on most servers. They&#8217;re needed only for registering a rebundled image so there&#8217;s now a script to install them: /usr/local/ec2-on-rails/install_ec2_api_tools.sh. The ruby-based <span class="caps">EC2</span> image tools are still installed.</li>
		<li>Removed <a href="Java">http://packages.ubuntu.com/feisty/libs/sun-java6-jre</a> and it&#8217;s massive list of dependencies because it was only needed for the <span class="caps">EC2 API</span> tools. This saved a huge amount of space.</li>
		<li>Removed ImageMagick, RMagick and hpricot due to popular demand. There will soon be cap2 tasks to customize which packages and gems are installed.</li>
	</ul>


	<h4>0.8.1, ami-b79a7fde</h4>


29 July 2007
	<ul>
	<li>Fixed S3 backup cron job.</li>
		<li>Added script to restore data from S3 (/usr/local/aws/bin/restore_app_db.rb). This is useful when setting up a staging server to test your deployment, you can have it set up with a copy of your production data to test your migrations.</li>
		<li>Rewrite rule now allows images/css on maintenance page</li>
		<li>Added empty /etc/apache2/sites-available/app.custom for custom Apache configuration in a separate file (so it can be deployed by rsync more easily).</li>
		<li>Added ImageMagick, RMagick and hpricot due to popular demand.</li>
	</ul>


	<h4>0.8.0, ami-4e907527</h4>


20 June 2007
	<ul>
	<li>Initial release.</li>
	</ul>


	<h2>How to submit patches</h2>


	<p>Read the <a href="http://drnicwilliams.com/2007/06/01/8-steps-for-fixing-other-peoples-code/">8 steps for fixing other people&#8217;s code</a> and for section <a href="http://drnicwilliams.com/2007/06/01/8-steps-for-fixing-other-peoples-code/#8b-google-groups">8b: Submit patch to Google Groups</a>, use the Google Group above.</p>


	<p>The trunk repository is <code>svn://rubyforge.org/var/svn/ec2onrails/trunk</code> for anonymous access.</p>


	<h2>License</h2>


	<p>This code is free to use under the terms of the <span class="caps">GPL</span> v2.</p>
    <p class="coda">
      <a href="http://pauldowman.com/contact/">Paul Dowman</a>, 8th October 2007<br>
      Theme extended from <a href="http://rb2js.rubyforge.org/">Paul Battley</a>
    </p>
</div>

<script src="http://www.google-analytics.com/urchin.js" type="text/javascript">
</script>
<script type="text/javascript">
_uacct = "UA-2759652-1";
urchinTracker();
</script>

</body>
</html>
